rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // SECURITY FIX: UID-based ownership instead of hardcoded email
    // Set OWNER_UID as environment variable in Firebase console
    // Go to Project Settings > Service accounts to find your UID
    
    match /portfolio/content {
      // SECURITY: Allow public read for viewer access
      allow read: if true;
      
      // SECURITY: Only authenticated owner can write (UID-based check)
      // Replace 'YOUR_OWNER_UID_HERE' with actual UID from Firebase Console
      allow write: if request.auth != null && 
                      request.auth.uid == 'YOUR_OWNER_UID_HERE';
    }
    
    // Alternative: If you set up user_roles table (recommended for scalability)
    // Uncomment this after creating user_roles table:
    /*
    match /user_roles/{roleId} {
      allow read: if request.auth != null;
      allow write: if false; // Only admin via console
    }
    
    match /portfolio/content {
      allow read: if true;
      allow write: if request.auth != null && 
                      hasRole(request.auth.uid, 'admin');
    }
    
    function hasRole(userId, role) {
      return exists(/databases/$(database)/documents/user_roles/$(userId + '_' + role));
    }
    */
    
    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
